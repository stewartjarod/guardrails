# guardrails.toml — Code guardrail configuration
# Docs: https://github.com/AstroGuard/guardrails

[guardrails]
name = "my-project"

# Presets: load a curated set of rules in one line.
# Available presets: "shadcn-strict", "shadcn-migrate", "ai-safety"
# Any [[rule]] with the same id as a preset rule overrides it.
# extends = ["shadcn-strict"]

# Files to include in scanning (default: everything)
include = ["src/**/*", "app/**/*", "components/**/*"]

# Files to exclude (defaults shown below are always applied)
exclude = [
    "**/node_modules/**",
    "**/target/**",
    "**/.git/**",
    "**/dist/**",
    "**/build/**",
    "**/.next/**",
    "**/vendor/**",
]


# ══════════════════════════════════════════════
# TAILWIND + SHADCN RULES
# ══════════════════════════════════════════════

# ──────────────────────────────────────────────
# Tailwind Dark Mode Enforcement
# Ensures every hardcoded Tailwind color class
# has a corresponding dark: variant. shadcn semantic
# tokens (bg-background, text-foreground, etc.) are
# allowed automatically since they handle theming
# via CSS custom properties.
# ──────────────────────────────────────────────

# [[rule]]
# id = "enforce-dark-mode"
# type = "tailwind-dark-mode"
# severity = "error"
# glob = "**/*.{tsx,jsx}"
# message = "Missing dark: variant for color class"
# suggest = "Use a shadcn semantic token or add a dark: counterpart"
# # Extra classes that don't need dark: variants:
# allowed_classes = ["bg-brand-gradient"]


# ──────────────────────────────────────────────
# shadcn Theme Token Enforcement
# Bans raw Tailwind color classes (bg-white, text-gray-900)
# in favor of CSS-variable-based semantic tokens
# (bg-background, text-foreground, bg-muted, etc.)
# Ships with a comprehensive default mapping.
# ──────────────────────────────────────────────

# [[rule]]
# id = "use-theme-tokens"
# type = "tailwind-theme-tokens"
# severity = "warning"
# glob = "**/*.{tsx,jsx}"
# message = "Use shadcn semantic token instead of raw color"
# # Extend the default mapping with your own brand tokens:
# token_map = ["bg-indigo-600=bg-brand", "text-indigo-50=text-brand-foreground"]
# # Allow specific raw colors that are intentionally unthemed:
# allowed_classes = ["bg-green-500"]


# ══════════════════════════════════════════════
# MIGRATION RULES
# Enforce a clean migration to Tailwind by banning
# conflicting patterns, imports, and dependencies.
# ══════════════════════════════════════════════

# ──────────────────────────────────────────────
# Banned Patterns
# Prevent specific code patterns from appearing
# ──────────────────────────────────────────────

[[rule]]
id = "no-inline-styles"
type = "banned-pattern"
severity = "warning"
pattern = "style={{"
glob = "**/*.{tsx,jsx}"
message = "Avoid inline styles — use Tailwind utility classes instead"
suggest = "Replace style={{ ... }} with Tailwind classes"

# [[rule]]
# id = "no-console-log"
# type = "banned-pattern"
# severity = "warning"
# pattern = "console.log("
# glob = "src/**/*.{ts,tsx}"
# message = "Remove console.log before committing — use the logger instead"
# suggest = "import { logger } from '@company/logger'"

# [[rule]]
# id = "no-ts-ignore"
# type = "banned-pattern"
# severity = "warning"
# pattern = "@ts-ignore"
# regex = false
# glob = "src/**/*.{ts,tsx}"
# message = "Use @ts-expect-error instead of @ts-ignore"


# ──────────────────────────────────────────────
# Banned Imports
# Prevent usage of deprecated or unwanted packages
# ──────────────────────────────────────────────

[[rule]]
id = "no-css-in-js"
type = "banned-import"
severity = "error"
packages = ["styled-components", "@emotion/styled", "@emotion/css", "@emotion/react"]
message = "CSS-in-JS libraries conflict with Tailwind — use utility classes instead"

# [[rule]]
# id = "no-moment"
# type = "banned-import"
# severity = "error"
# packages = ["moment", "moment-timezone"]
# message = "moment.js is deprecated — use date-fns or Temporal API"
# suggest = "import { format } from 'date-fns'"


# ──────────────────────────────────────────────
# Banned Dependencies
# Prevent packages from appearing in manifests
# ──────────────────────────────────────────────

[[rule]]
id = "no-competing-frameworks"
type = "banned-dependency"
severity = "error"
packages = ["bootstrap", "bulma", "@mui/material", "antd"]
message = "Competing CSS framework detected — this project uses Tailwind"

# [[rule]]
# id = "no-request-package"
# type = "banned-dependency"
# severity = "error"
# packages = ["request", "request-promise"]
# manifest = "package.json"
# message = "The 'request' package is deprecated — use 'node-fetch' or 'undici'"


# ══════════════════════════════════════════════
# COMING IN v2
# These rule types are planned but not yet implemented.
# ══════════════════════════════════════════════

# ──────────────────────────────────────────────
# Ratchet Rules
# Enforce decreasing counts of legacy patterns over time.
# Use `guardrails baseline` to find current count,
# then set max_count and decrease it as you refactor.
# ──────────────────────────────────────────────

# [[rule]]
# id = "ratchet-legacy-fetch"
# type = "ratchet"
# severity = "error"
# pattern = "legacyFetch("
# max_count = 47
# glob = "src/**/*.ts"
# message = "Migrate remaining legacyFetch calls to apiFetch"
# suggest = "import { apiFetch } from '@company/http'"


# ──────────────────────────────────────────────
# Required Patterns
# Ensure certain patterns exist in matching files
# ──────────────────────────────────────────────

# [[rule]]
# id = "error-boundary-in-pages"
# type = "required-pattern"
# severity = "error"
# glob = "src/pages/**/*.tsx"
# pattern = "ErrorBoundary"
# message = "All page components must wrap content in an ErrorBoundary"


# ──────────────────────────────────────────────
# File Presence
# Ensure required project files exist
# ──────────────────────────────────────────────

# [[rule]]
# id = "has-readme"
# type = "file-presence"
# severity = "warning"
# required_files = ["README.md", "LICENSE"]
# message = "Projects must have a README.md and LICENSE file"
